webpackJsonp([77],{"+0bQ":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("hRKE"),r=s.n(a),i=s("4YfN"),o=s.n(i),n=(s("xd7I"),s("ZWLj"),s("HVJf")),c=s("YV7O"),u=s("vGYV"),h={name:"searchResult",components:{mybanner:c.a},data:function(){return{text:"查询结果",searchData:"",account:"",ajaxData:[],orderList:[],dealList:[],myCustomerList:[],type:"",compareTime:[]}},created:function(){var t=localStorage.getItem("ajaxData");this.ajaxData=JSON.parse(t);var e=localStorage.getItem("accountMsg");this.account=JSON.parse(e).name.trim()},computed:o()({},Object(n.d)({headerStatus:function(t){return t.customerHeader.headerStatus},customerAjaxParams:function(t){return t.customer.customerAjaxParams},customerList:function(t){return t.customer.customerList},orderInfoDetails:function(t){return t.orderInfoDetails.orderInfoDetails}})),methods:o()({},Object(n.c)(["setOrderInfoDetails","setDealOrderInfoDetails","setTabStatus","setCustomerAjaxParams","setOrderTotalPrice","setOrderDiscountPrice"]),{isExpire:function(t){if(this.orderList.records)for(var e=this.orderList.records,s=new Date,a=0;a<t;a++)if(e[a]){var r=u.a.compareTimeStamp(e[a].demandTime,s);"已关闭"===e[a].orderStatus||this.$set(this.compareTime,a,r)}},getCustomerList:function(t){var e=this;u.a.getAjax(this,"order",{account:this.account,page:1,limit:50,key:t},"v2").then(function(t){if(t){e.orderList=t.data;var s=e.orderList.records.length;e.isExpire(s)}}).catch(function(s){510===s&&e.getCustomerList(t)})},getDealCustomerList:function(t){var e=this;u.a.getAjax(this,"makedeal",{account:this.account,page:1,limit:50,key:t},"v2").then(function(t){t&&(e.dealList=t.data)}).catch(function(s){510===s&&e.getDealCustomerList(t)})},judgeType:function(){this.headerStatus[1].status?this.type=2:this.type=1},getMyCustomerList:function(t){var e=this,s=[this.customerAjaxParams,{}],a=s[0],i=s[1];for(var o in a)i[o]=a[o];console.log(t,void 0===t?"undefined":r()(t)),i.key=t,i.account=this.account,this.setCustomerAjaxParams(i),console.log(123,this.customerAjaxParams),u.a.getAjax(this,"customer",this.customerAjaxParams,"v2").then(function(t){t&&(e.myCustomerList=t.data)}).catch(function(s){510===s&&e.getMyCustomerList(t)})},toCustomerInfo:function(t){this.$router.push("/customerInfo/"+t)},calcPrice:function(t){if(t.orderItemList){var e,s=0;t.orderItemList.forEach(function(t,e){s+=t.price*t.quantity}),e=s-t.totalAmount,this.setOrderTotalPrice(s),this.setOrderDiscountPrice(e)}},orderInfoIn:function(t){var e=this;u.a.getAjax(this,"orderById",{orderId:this.orderList.records[t].orderId},"v2").then(function(t){t&&(e.setOrderInfoDetails(t.data),e.calcPrice(e.orderInfoDetails))}).catch(function(s){510===s&&e.orderInfoIn(t)}),this.$router.push({path:"/enquiryInfo"})},getDetails:function(t){var e=this;this.setTabStatus(u.a.btnList(["订单信息","需求信息"],0)),u.a.getAjax(this,"customerinfo",{customerId:this.dealList.records[t].customerId,account:this.account},"v2").then(function(t){t&&e.setDealOrderInfoDetails(t.data)}).catch(function(s){510===s&&e.getDetails(t)}),this.$router.push({path:"/dealDetails",query:{username:this.dealList.records[t].username,sex:this.dealList.records[t].sex,phone:this.dealList.records[t].phone}})},setSearchData:function(t){var e='{"searchData":" '+t+'"}';localStorage.setItem("searchData",e)},getSearchData:function(){var t=localStorage.getItem("searchData"),e=JSON.parse(t);this.key=this.trim(e.searchData)},trim:function(t){return t.replace(/(^\s*)|(\s*$)/g,"")}}),activated:function(){if(!this.$route.meta.isUseCache){if(this.searchData=this.$route.query,this.searchData){var t=this.trim(this.searchData.key);this.setSearchData(t),this.getSearchData(),this.myCustomerList=[],this.dealList=[],this.orderList=[],t&&(this.getDealCustomerList(t),this.getCustomerList(t),this.getMyCustomerList(t))}this.$route.meta.isUseCache=!1}},beforeRouteLeave:function(t,e,s){"searchResult"==t.name&&(t.meta.isUseCache=!0),s()}},m={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"searchResult"},[s("mybanner",{attrs:{title:t.text}}),t._v(" "),t.headerStatus[0].status?s("ul",{staticClass:"customerList"},t._l(t.myCustomerList.records,function(e,a){return s("li",{key:"customerList"+a,staticClass:"customerContent",on:{click:function(s){return t.toCustomerInfo(e.id)}}},[t._v("\n      "+t._s(e.name)+"\n      "),s("ul",[s("li",[s("div",{class:"urgence"+e.urgency}),t._v(" "),s("strong",[t._v(t._s(e.username)),s("i",{class:"important"+e.important})]),t._v(" "),s("span",[t._v(t._s(e.followTime))])]),t._v(" "),s("li",[t._v(t._s(e.intention))]),t._v(" "),s("li",[t._v(t._s(e.probability))])])])}),0):t._e(),t._v(" "),t.headerStatus[1].status?s("ul",{staticClass:"orderList"},t._l(t.orderList.records,function(e,a){return s("li",{key:"list"+a,class:{active:t.compareTime[a]},on:{click:function(e){return t.orderInfoIn(a)}}},[s("span",[t._v(t._s(a+1))]),t._v(" "),s("span",{class:{active:t.compareTime[a]}},[t._v(t._s(e.username))]),t._v(" "),s("span",[t._v(t._s(e.demandTime))]),t._v(" "),s("span",{class:{active:t.compareTime[a]}},[t._v(t._s(e.orderStatus))])])}),0):t._e(),t._v(" "),t.headerStatus[2].status?s("ul",{staticClass:"dealList"},t._l(t.dealList.records,function(e,a){return s("li",{key:"customerList"+a,on:{click:function(e){return t.getDetails(a)}}},[s("span",[t._v(t._s(a+1))]),t._v(" "),s("span",[t._v(t._s(e.username))]),t._v(" "),s("span",[t._v(t._s(e.phone))]),t._v(" "),s("span",[t._v(t._s(e.recordTime))])])}),0):t._e()],1)},staticRenderFns:[]};var d=s("C7Lr")(h,m,!1,function(t){s("dZEb")},"data-v-96544576",null);e.default=d.exports},dZEb:function(t,e){}});