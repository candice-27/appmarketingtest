webpackJsonp([16],{"68Xj":function(t,e,r){"use strict";var a=r("4YfN"),i=r.n(a),s=r("CqDD"),n=r("xd7I"),o=(r("7LQH"),r("HVJf")),c=r("sC8f"),l=r("vGYV"),d=(r("/gIj"),r("wSez"));n.default.component(d.Loadmore.name,d.Loadmore);var u={name:"enquiryOrder",components:{TopBar:c.a},props:["changeResultTit"],data:function(){return{account:"",ajaxData:[],dealCusList:[],addPullData:[],page:3,limit:10,allPage:"",baceLimit:30,allLoaded:!1,id:"",compareTime:[],activecolor:[],topbar:{leftTitle:"客户信息",centerTitle:"电话",rightTitle:"最近跟进"},parmas:{}}},computed:i()({},Object(o.d)({orderList:function(t){return t.orderList.orderList},headerStatus:function(t){return t.customerHeader.headerStatus},orderInfoDetails:function(t){return t.orderInfoDetails.orderInfoDetails},orderScroll:function(t){return t.customerScroll.orderScroll},customerTime:function(t){return t.rightContainer.customerTime},isSelectStatus:function(t){return t.rightContainer.isSelectStatus},orderTotalPrice:function(t){return t.orderInfoDetails.orderTotalPrice},orderDiscountPrice:function(t){return t.orderInfoDetails.orderDiscountPrice},customerAjaxParams:function(t){return t.customer.customerAjaxParams}})),watch:{headerStatus:function(){this.headerStatus[1].status&&(0==this.orderScroll&&(this.isSelectStatus?this.loadSelectData(this.customerTime):this.loadData()),this.$refs.order.addEventListener("scroll",this.handleScroll,!0),this.$refs.order.scrollTop=this.orderScroll)},baceLimit:function(){this.isExpire(this.baceLimit)},customerTime:function(){this.setIsSelectStatus(!0),this.initData(),this.loadSelectData(this.customerTime),""===this.customerTime.startTime&&(this.setIsSelectStatus(!1),this.loadData())}},mounted:function(){this.$refs.order.addEventListener("scroll",this.handleScroll,!0),this.$refs.order.scrollTop=this.orderScroll},created:function(){this.parmas=Object(s.a)(this.customerAjaxParams,this.parmas),this.parmas.type="Approved",this.isSelectStatus?this.loadSelectData(this.customerTime):this.loadData()},methods:i()({initData:function(){this.baceLimit=30,this.setOrderScroll(0),this.$refs.order.scrollTop=this.orderScroll,localStorage.removeItem("selectLimit"),localStorage.removeItem("limit"),this.getSelectLimit()},handleScroll:function(t){var e=t.target.scrollTop;this.setOrderScroll(e)},isExpire:function(t){if(this.orderList.records)for(var e=this.orderList.records,r=new Date,a=0;a<t;a++)if(e[a]){var i=l.a.compareTimeStamp(e[a].demandTime,r);"关闭"===e[a].orderStatus||this.$set(this.compareTime,a,i)}}},Object(o.c)(["setOrderList","setOrderInfoDetails","setOrderScroll","setIsSelectStatus","setOrderTotalPrice","setOrderDiscountPrice","setDealTabStatus"]),{loadBottom:function(){this.$refs.loadmore.onBottomLoaded(),this.isSelectStatus?this.pullDownData(this.customerTime.startTime,this.customerTime.endTime):this.pullDownData()},getOrderList:function(t,e,r,a){var i=this;this.parmas.page=t,this.parmas.limit=e,this.parmas.sd=r,this.parmas.ed=a,this.parmas.sort="",this.parmas.u="",this.parmas.l="",l.a.getAjax("/v3/app/customer/list",this.parmas).then(function(e){e&&(i.allLoaded=!1,i.allPage=Math.ceil(e.data.total/10),t<=3?(i.setOrderList(e.data),i.dealCusList=i.orderList,i.$emit("changeResultTit","全部客户 ("+(null==i.orderList.total?"0":i.orderList.total)+")")):(i.getDiffLimit(),i.addPullData=e.data,i.dealCusList.records=i.dealCusList.records.concat(i.addPullData.records),i.setOrderList(i.dealCusList)),i.isExpire(i.baceLimit))}).catch(function(s){510===s&&i.getOrderList(t,e,r,a)})},loadData:function(){this.getLimit();var t=(this.baceLimit-30)/10;this.page=3+t,this.getOrderList(1,this.baceLimit)},loadSelectData:function(t){if(t.startTime){this.getSelectLimit();var e=(this.baceLimit-30)/10;this.page=3+e,this.getOrderList(1,this.baceLimit,t.startTime,t.endTime)}},pullDownData:function(t,e){this.page<this.allPage?(this.allLoaded=!0,this.page++,this.getOrderList(this.page,this.limit,t,e)):(this.allLoaded=!0,l.a.tip("没有更多数据了"))},getDiffLimit:function(){this.isSelectStatus?(this.setSelectLimit(this.baceLimit+10),this.getSelectLimit()):(this.setLimit(this.baceLimit+10),this.getLimit())},setLimit:function(t){var e='{"limit":" '+t+'"}';localStorage.setItem("limit",e)},setSelectLimit:function(t){var e='{"selectLimit":" '+t+'"}';localStorage.setItem("selectLimit",e)},getLimit:function(){var t=localStorage.getItem("limit");t?this.baceLimit=parseInt(JSON.parse(t).limit):this.setLimit(this.baceLimit)},getSelectLimit:function(t){var e=localStorage.getItem("selectLimit");e?this.baceLimit=parseInt(JSON.parse(e).selectLimit):this.setSelectLimit(this.baceLimit)},calcPrice:function(t){if(t.orderItemList){var e,r=0;t.orderItemList.forEach(function(t,e){r+=t.price*t.quantity}),e=r-t.totalAmount,this.setOrderTotalPrice(r),this.setOrderDiscountPrice(e)}},orderInfoIn:function(t){this.setDealTabStatus(l.a.btnList(["订单信息","客户信息","意向信息"],0)),this.$router.push({path:"/enquiryInfo",query:{id:t,status:3}})}})},h={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{ref:"order",staticClass:"enquiryOrder"},[r("TopBar",{attrs:{topBarTitle:t.topbar}}),t._v(" "),r("ul",[r("mt-loadmore",{ref:"loadmore",attrs:{"bottom-method":t.loadBottom,"bottom-all-loaded":t.allLoaded,"auto-fill":!1}},t._l(t.orderList.records,function(e,a){return r("li",{key:"list"+a,class:{active:t.compareTime[a]},on:{click:function(r){return t.orderInfoIn(e.accntId)}}},[r("div",{staticClass:"name"},[r("i",{class:"important"+e.level}),t._v(" "),r("span",{class:{active:t.compareTime[a]}},[t._v(t._s(e.username))]),t._v(" "),r("strong",{class:"urgency"+e.urgency})]),t._v(" "),"0"!==e.phone?r("span",{staticClass:"phone"},[t._v(t._s(e.phone))]):r("span",{staticClass:"phone"},[t._v("未收集")]),t._v(" "),r("span",{staticClass:"date",class:{active:t.compareTime[a]}},[t._v(t._s(e.followDate))])])}),0)],1)],1)},staticRenderFns:[]};var m=r("C7Lr")(u,h,!1,function(t){r("cgrL")},"data-v-6e3a7454",null);e.a=m.exports},E4CW:function(t,e){},"JG+e":function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r("4YfN"),i=r.n(a),s=r("HVJf"),n=r("68Xj"),o=r("YV7O"),c={render:function(){var t=this.$createElement,e=this._self._c||t;return e("ul",{staticClass:"infoHeader"},[e("li",[this._v("全部订单("+this._s(this.count)+")")]),this._v(" "),e("li",{staticClass:"select",on:{click:this.select}},[this._v("筛选")])])},staticRenderFns:[]};var l=r("C7Lr")({name:"infoHeader",props:["title","count"],data:function(){return{fix:"",top:""}},mounted:function(){},methods:{select:function(){this.$emit("select")}}},c,!1,function(t){r("Phg5")},"data-v-8f79e3ee",null).exports,d=r("sC8f"),u=r("xd7I"),h=r("wSez"),m={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("li",{staticClass:"orderLi"},[r("p",[t._v(t._s(t.obj.username))]),t._v(" "),r("p",[t._v(t._s(t.obj.demandTime))]),t._v(" "),r("p",[t._v(t._s(t.obj.status))])])},staticRenderFns:[]};var f=r("C7Lr")({name:"orderLi",props:["obj"],components:{},data:function(){return{}},mounted:function(){},methods:{}},m,!1,function(t){r("wb0s")},"data-v-0c12431a",null).exports,p=r("0xDb");u.default.component(h.Loadmore.name,h.Loadmore);var v=new p.a,g={name:"orderCentent",props:[],components:{Loadmore:h.Loadmore,orderLi:f},data:function(){return{topbar:{leftTitle:"客户信息",centerTitle:"订单交期",rightTitle:"订单状态"},allLoaded:!1}},computed:i()({},Object(s.d)({orderData:function(t){return t.work.orderData},orderSearchParam:function(t){return t.work.orderSearchParam}}),Object(s.b)(["orderList"])),mounted:function(){var t={page:1,limit:30};this.setOrderSearchParam(t),this.getOrderList(t)},methods:i()({},Object(s.c)(["setOrderData","setOrderSearchParam"]),{getOrderList:function(t){var e=this;v.getOrderList(t).then(function(t){if(e.$refs.loadmore.onTopLoaded(),t=t.data){var r=e.orderData.records||[],a=t.records;t.records=r.concat(a),e.setOrderData(t),console.log(t),t.pages==e.orderSearchParam.page?e.allLoaded=!0:e.allLoaded=!1}}).catch(function(r){510===r&&e.getOrderList(t)})},loadBottom:function(){this.orderSearchParam.page++,this.getOrderList(this.orderSearchParam),this.$refs.loadmore.onBottomLoaded()},toOrderDetail:function(t){this.$router.push({path:"/orderDetail",query:{orderId:t}})}})},S={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ul",{staticClass:"orderCentent"},[r("Loadmore",{ref:"loadmore",attrs:{"bottom-method":t.loadBottom,"bottom-all-loaded":t.allLoaded,"auto-fill":!1}},[t._l(t.orderList,function(e,a){return r("orderLi",{key:"orderList"+a,tag:"li",attrs:{obj:e},nativeOn:{click:function(r){return t.toOrderDetail(e.orderId)}}})}),t._v(" "),t.orderList.length<=0?r("li",{staticClass:"no-record"},[t._v("暂无记录")]):t._e()],2)],1)},staticRenderFns:[]};var L=r("C7Lr")(g,S,!1,function(t){r("M7m2")},"data-v-5faa6924",null).exports,D={name:"orderList",props:[],components:{TopBar:d.a,OrderCentent:L},data:function(){return{topbar:{leftTitle:"客户信息",centerTitle:"订单交期",rightTitle:"订单状态"},orderArr:[]}},mounted:function(){},methods:{}},_={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"orderList"},[e("OrderCentent",{attrs:{list:this.orderArr}})],1)},staticRenderFns:[]};var T=r("C7Lr")(D,_,!1,function(t){r("igsV")},"data-v-5372eaa0",null).exports,C=(r("CqDD"),r("7LQH"),r("vGYV"));u.default.use(s.a),u.default.component(h.DatetimePicker.name,h.DatetimePicker);var O=new p.a,b={name:"rightContainer",props:[""],data:function(){return{pickerValue:new Date,startDateVal:"",endDateVal:C.a.indexTime(new Date,"day"),dateType:"",orderSearchBtns:[],orderStatusList:[],orderStatus:{},ajaxData:[],marginTop:"",orderSelectParam:{}}},computed:i()({},Object(s.d)({orderData:function(t){return t.work.orderData},orderSearchParam:function(t){return t.work.orderSearchParam},rightContainerStatus:function(t){return t.rightContainer.rightContainerStatus},customerAjaxParams:function(t){return t.customer.customerAjaxParams}}),{countTime:function(){var t=[new Date(this.startDateVal).getTime(),new Date(this.endDateVal).getTime()],e=t[0],r=t[1];return Math.ceil((r-e)/864e5)}}),created:function(){var t=localStorage.getItem("ajaxData");this.ajaxData=JSON.parse(t),this.initStartDateVal()},mounted:function(){this.isIPhoneX();new Date;this.getOrderStatusList()},methods:i()({},Object(s.c)(["setOrderData","setOrderSearchParam","setRightContainerStatus","setCustomerAjaxParams","setAllLoaded","setCustomerList"]),{initStartDateVal:function(){var t=new Date;t=(t=C.a.indexTime(t,"day")).slice(0,8)+"01",this.startDateVal=t},openDatePicker:function(t){this.dateType=t,this.$refs.datePicker.open()},resizeCustomerList:function(){C.a.changeBtnStatus(this.orderSearchBtns,"");var t={page:1,limit:30};this.setOrderSearchParam(t),this.getOrderList(t),this.setRightContainerStatus("hideRightContainer")},hideRightContainer:function(){var t={page:1,limit:30,status:this.orderStatus.code,startTime:this.startDateVal,endTime:this.endDateVal};this.setOrderSearchParam(t),this.getOrderList(t),this.setRightContainerStatus("hideRightContainer")},hideRightBar:function(){this.setRightContainerStatus("hideRightContainer")},orderSearchSelect:function(t){this.orderStatus.code===this.orderStatusList[t].code?(C.a.changeBtnStatus(this.orderSearchBtns),this.orderStatus={}):(this.orderStatus={name:this.orderStatusList[t].name,code:this.orderStatusList[t].code},C.a.changeBtnStatus(this.orderSearchBtns,t)),console.log(11111111,this.orderStatus)},handleConfirm:function(t){var e,r=null,a=null;if("start"===this.dateType){if(r=new Date(t).getTime(),C.a.indexTimeB(t)[1]===C.a.indexTimeB(new Date(this.endDateVal))[1]);else if(r-new Date(this.endDateVal).getTime()>0)return void alert("起始日不能大于结束日")}else if(a=new Date(t).getTime(),C.a.indexTimeB(t)[1]===C.a.indexTimeB(new Date(this.startDateVal))[1]);else if(new Date(this.startDateVal).getTime()-a>0)return void alert("结束日不能小于起始日");e=C.a.indexTime(t,"day"),this[this.dateType+"DateVal"]=e},isIPhoneX:function(t){!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)&&(812==screen.height&&375==screen.width||896==screen.height&&414==screen.width?this.marginTop="-5.86":this.marginTop="")},getOrderStatusList:function(){var t=this;O.getArea("FS_ORDER_STATUS").then(function(e){if(e=e.data){t.orderStatusList=e;var r=e.map(function(t){return t.name});t.orderSearchBtns=C.a.btnList(r)}}).catch(function(e){510===e&&t.getOrderStatusList()})},getOrderList:function(t){var e=this;O.getOrderList(t).then(function(t){(t=t.data)&&e.setOrderData(t)}).catch(function(r){510===r&&e.getOrderList(t)})}})},P={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{class:"rightContainer "+t.rightContainerStatus},[r("div",{staticClass:"content",on:{click:function(e){return e.target!==e.currentTarget?null:t.hideRightBar(e)}}},[r("div",[r("ul",[r("li",{staticClass:"time"},[r("h3",[t._v("订单交期")]),t._v(" "),r("ul",[r("li",{on:{click:function(e){return t.openDatePicker("start")}}},[r("p",[t._v("起始日")]),t._v(" "),r("strong",[t._v(t._s(t.startDateVal))])]),t._v(" "),t._m(0),t._v(" "),r("li",{on:{click:function(e){return t.openDatePicker("end")}}},[r("p",[t._v("结束日")]),t._v(" "),r("strong",[t._v(t._s(t.endDateVal))])]),t._v(" "),r("li",[r("span",[t._v("共"+t._s(t.countTime+1)+"日")])])])]),t._v(" "),r("div",[r("h3",[t._v("订单状态")]),t._v(" "),r("ul",{staticClass:"status"},t._l(t.orderSearchBtns,function(e,a){return r("li",{key:"orderSearchBtns"+a},[r("button",{class:{on:e.status},on:{click:function(e){return t.orderSearchSelect(a)}}},[t._v(t._s(e.name))])])}),0)]),t._v(" "),r("li",[r("mt-datetime-picker",{ref:"datePicker",attrs:{type:"date","year-format":"{value} 年","month-format":"{value} 月","day-format":"{value} 日"},on:{confirm:t.handleConfirm},model:{value:t.pickerValue,callback:function(e){t.pickerValue=e},expression:"pickerValue"}})],1)]),t._v(" "),r("div",{staticClass:"botBtns"},[r("button",{on:{click:t.resizeCustomerList}},[t._v("重置")]),t._v(" "),r("button",{staticClass:"on",on:{click:t.hideRightContainer}},[t._v("完成")])])])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("li",[e("span",[this._v("至")])])}]};var k=r("C7Lr")(b,P,!1,function(t){r("ykdn")},"data-v-2363383f",null).exports,y={components:{EnquiryOrder:n.a,myBanner:o.a,InfoHeader:l,OrderList:T,TopBar:d.a,OrderSearchRightContainer:k},props:["myStyle"],data:function(){return{searchKey:"",topbar:{leftTitle:"客户信息",centerTitle:"订单交期",rightTitle:"订单状态"}}},computed:i()({},Object(s.d)({orderData:function(t){return t.work.orderData},orderSearchParam:function(t){return t.work.orderSearchParam},rightContainerStatus:function(t){return t.rightContainer.rightContainerStatus}})),created:function(){this.checkLogin()},mounted:function(){this.setOrderData([])},methods:i()({},Object(s.c)(["setOrderData","setOrderSearchParam","setRightContainerStatus"]),{checkLogin:function(){var t=localStorage.getItem("ajaxData");if(t){var e=JSON.parse(t).timestamp;e=Date.parse(new Date)-JSON.parse(t).timestamp,(e/=864e5)>10&&this.$router.replace({path:"./Login"})}else this.$router.replace({path:"./Login"})},changeOrderResultTit:function(t){this.orderResultTit=t},search:function(){var t={key:this.searchKey.replace(/\s+/g,""),page:1,limit:30};this.setOrderSearchParam(t),this.getOrderData(t)},inputChange:function(t){var e=t.target.value;if(""===(e=e.replace(/\s+/g,""))){var r={page:1,limit:30};this.setOrderSearchParam(r),this.getOrderData(r)}},getOrderData:function(t){var e=this;C.a.getAjax("/v3/app/order/list",t).then(function(t){(t=t.data)&&(console.log("请求 的订单",t.records),e.setOrderData(t))})},select:function(){this.setRightContainerStatus(!0)}})},x={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"orderSearch"},[r("div",{staticClass:"orderSearchHeader"},[r("my-banner",{attrs:{title:"订单查询"}}),t._v(" "),r("form",{staticClass:"searchForm",attrs:{action:""},on:{submit:function(t){t.preventDefault()}}},[r("input",{directives:[{name:"model",rawName:"v-model",value:t.searchKey,expression:"searchKey"}],ref:"inpComp",staticClass:"input",attrs:{type:"search",placeholder:"请输入姓名或电话"},domProps:{value:t.searchKey},on:{change:t.inputChange,keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)},input:function(e){e.target.composing||(t.searchKey=e.target.value)}}})]),t._v(" "),r("InfoHeader",{attrs:{count:t.orderData.total},on:{select:t.select}}),t._v(" "),r("TopBar",{attrs:{topBarTitle:t.topbar}})],1),t._v(" "),r("order-list"),t._v(" "),r("OrderSearchRightContainer")],1)},staticRenderFns:[]};var B=r("C7Lr")(y,x,!1,function(t){r("E4CW")},null,null);e.default=B.exports},M7m2:function(t,e){},Phg5:function(t,e){},cgrL:function(t,e){},igsV:function(t,e){},sC8f:function(t,e,r){"use strict";var a={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"topBar"},[r("span",[t._v(t._s(t.topBarTitle.leftTitle))]),t._v(" "),r("span",[t._v(t._s(t.topBarTitle.centerTitle))]),t._v(" "),r("span",[t._v(t._s(t.topBarTitle.rightTitle))])])},staticRenderFns:[]};var i=r("C7Lr")({props:["topBarTitle"]},a,!1,function(t){r("sk0q")},"data-v-22ce740f",null);e.a=i.exports},sk0q:function(t,e){},wb0s:function(t,e){},ykdn:function(t,e){}});