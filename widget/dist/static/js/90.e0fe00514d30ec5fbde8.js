webpackJsonp([90],{P4oL:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o("3cXf"),a=o.n(s),r=o("4YfN"),i=o.n(r),n=o("aA9S"),d=o.n(n),l=(o("xd7I"),o("YV7O")),c=o("WoPn"),u=o("OVlV"),p=o("ZaQL"),m=o("UaEH"),f=o("otx3"),h=o("T0rX"),g=o("yN+A"),y=o("vRxf"),v=o("TB9H"),I=o("RrjH"),b=o("W4OY"),N=o("ab77"),P=o("ijls"),_=o("+ZJN"),k=o("YVni"),L=o("EfbY"),D=o("l6Gh"),S=o("tqtp"),R=(o("wSez"),o("HVJf")),x=o("vGYV"),$=o("0xDb"),T=(o("BvhE").Base64,new $.a),C={data:function(){return{form:{oppId:"",goodsList:[],addressId:"",shopId:"",arrivalDate:"",budget:"",deliverDate:"",source:"",stylePref:"",progress:"",colorPref:"",competingGoods:"",buyReason:"",depositPaid:"",argreeDiscount:"",remark:"",urgency:"",level:"A"},sleepName:"",recordList:[],isFirstEnter:!1,goodsValue:"",shopName:"",sourceName:"",apartmentType:"",elevator:"",address:"",buyReasonName:"",stylePrefName:"",progressName:"",colorPrefName:"",selectIcon:!0,readonly:!1,failReason:"",isPrompt:!1,customerId:"",path:"",status:"",urgency:"否",url:"",go:-1,argreeDiscountTxt:"",phone:""}},components:{mybanner:l.a,yanInput:u.a,yanTextarea:m.a,dateSelect:g.a,titleBar:c.a,intentionSelect:f.a,storeSelect:h.a,durationSelect:y.a,sourceSelect:v.a,addressSelect:I.a,reasonSelect:b.a,styleSelect:N.a,progressSelect:_.a,classifySelect:L.a,recordPannel:D.a,yanLayerPrompt:S.a,colorSelect:P.a,discountSelect:k.a,yanOneInput:p.a},watch:{$route:function(e,t){var o=this;if("selectAddress"===t.name){if(this.$store.state.addressList<=0)return this.form.addressId="",this.address="未收集地址",this.apartmentType="未收集户型",void(this.elevator="未收集");this.form.addressId=this.$store.state.addressId;var s={};if(this.$store.state.addressId){this.$store.state.addressList.map(function(e,t){console.log(e),e.addressId===o.$store.state.addressId&&(console.log("进来了"),s=d()({},e))});var a=""+s.province+s.city+s.district+s.address,r="Y"===s.elevator?"有":"无";this.address=a,this.apartmentType=s.apartmentType,this.elevator=r,this.form.addressId=this.$store.state.addressId}else this.address="未收集地址",this.apartmentType="未收集户型",this.elevator="未收集"}if("intentionProduct"===t.name)if(console.log("进来intentionProduct"),console.log(this.$store.state.checkedList.length),this.$store.state.checkedList.length>0){var i=[];this.$store.state.checkedList.map(function(e,t){i.push(e.goodsName)}),this.goodsValue=i.join("、"),this.form.goodsList=this.$store.state.checkedList.map(function(e,t){var o={};return o.goodsId=e.crmId,o.goodsName=e.goodsName,o.quantity=e.quantity,o})}else this.goodsValue="",this.form.goodsList=[];if("chooseShop"===t.name){console.log("进来chooseShop");var n=JSON.parse(localStorage.getItem("shops"));console.log(n),this.go=-2;var l=localStorage.getItem("shopIndex");console.log(l),n.map(function(e,t){l==t&&(o.form.shopId=e.id,o.shopName=e.name)})}}},computed:i()({},Object(R.d)("addIntention",["title","formInfo","titleModule"]),Object(R.d)(["checkedList"])),activated:function(){},mounted:function(){},methods:i()({},Object(R.c)("addIntention",["updateTitle"]),Object(R.c)(["updateAddress","setClassify","setCheckedList","updateSearchProductList","setFiles","setPicVal","setAddressId"]),{changeToken:function(){var e=JSON.parse(localStorage.getItem("token"));e.access_token="1234567891234567891234567",e.refresh_token="2e0ce02f-6076-43d2-b935-5e329faedd0",localStorage.setItem("token",a()(e))},getShop:function(){var e=this,t=JSON.parse(localStorage.getItem("shops"));console.log(t);var o=localStorage.getItem("shopIndex");console.log(o),t.map(function(t,s){o==s&&(e.form.shopId=t.id,e.shopName=t.name)})},getProduct:function(){if(this.$store.state.checkedList.length<=0)this.goodsValue="",this.form.goodsList=[];else{var e=[];this.$store.state.checkedList.map(function(t,o){e.push(t.goodsName)}),this.goodsValue=e.join("、"),this.form.goodsList=this.$store.state.checkedList.map(function(e,t){var o={};return o.goodsId=e.crmId,o.goodsName=e.goodsName,o.quantity=e.quantity,o})}},addRecord:function(){this.$router.push({name:"followRecord",query:{oppId:this.oppId}})},listen:function(){""===this.form.address&&x.a.tip("请先选择地址")},getOpportunity:function(e){var t=this;T.getOpportunity(e).then(function(e){if(0===e.code){if(e.data.goodsList.length>0){t.setCheckedList([]);var o=[];e.data.goodsList.map(function(e,t){o.push(e.goodsName)}),t.goodsValue=o.join("、");var s=e.data.goodsList.map(function(e,t){var o={};return o.crmId=e.goodsId,o.goodsName=e.goodsName,o.quantity=e.quantity,o});t.setCheckedList(s),t.form.goodsList=e.data.goodsList}else t.setCheckedList([]),t.form.goodsList=[];if(t.sleepName=""==e.data.sleepName?"未分配":e.data.sleepName,t.status=e.data.status,console.log(4444,e.data.shopId),t.shopName=""===e.data.shopId?"":t.getShopName(e.data.shopId),t.form.shopId=e.data.shopId,t.form.arrivalDate=e.data.arrivalDate,t.sourceName=e.data.sourceName,t.form.source=e.data.source,t.buyReasonName=""==e.data.buyReasonName?"":e.data.buyReasonName,t.form.buyReason=e.data.buyReason,t.stylePrefName=""==e.data.stylePrefName?"":e.data.stylePrefName,t.form.stylePref=e.data.stylePref,t.progressName=""==e.data.progressName?"":e.data.progressName,t.form.progress=e.data.progress,t.form.competingGoods=""==e.data.competingGoods?"":e.data.competingGoods,t.colorPrefName=""==e.data.colorPrefName?"":e.data.colorPrefName,t.form.colorPref=e.data.colorPref,t.form.deliverDate=""==e.data.deliverDate?"":e.data.deliverDate,t.form.remark=e.data.remark,t.form.budget=e.data.budget,t.form.depositPaid=e.data.depositPaid,t.form.argreeDiscount=e.data.argreeDiscount,""!==e.data.argreeDiscount){var a=parseFloat(e.data.argreeDiscount)/10;console.log("333",a),t.argreeDiscountTxt=a+"折"}else t.argreeDiscountTxt=0;t.form.level=""===e.data.level?"A":e.data.level,t.recordList=e.data.recordList,e.data.urgency?(t.urgency="是",t.form.urgency=e.data.urgency?"true":"false"):(t.urgency="否",t.form.urgency=e.data.urgency?"true":"false");var r=""===e.data.addressId?"":t.getAddress(e.data.addressId);t.address=r,t.form.addressId=e.data.addressId}else x.a.tip(e.msg)}).catch(function(o){510===o&&t.getOpportunity(e)})},getAddress:function(e){var t=this;T.getAddress(e).then(function(e){0===e.code?(t.address=""+e.data.provinceName+e.data.cityName+e.data.districtName+e.data.address,t.apartmentType=e.data.apartmentTypeName,t.elevator="Y"===e.data.elevator?"有电梯":"无电梯"):x.a.tip(e.msg)}).catch(function(o){510===o&&t.getAddress(e)})},getShopName:function(e){var t=localStorage.getItem("shops"),o=void 0;return JSON.parse(t).map(function(t,s){if(t.id===e)return o=t.name}),o},valid:function(){if(""===this.customerId)return x.a.tip("客户ID不能为空"),!1;if(""===this.form.arrivalDate)return x.a.tip("进店日期不能为空"),!1;if(""===this.form.shopId)return x.a.tip("门店不能为空"),!1;if(""===this.form.source)return x.a.tip("客户来源不能为空"),!1;if(""===this.form.addressId)return x.a.tip("请选择地址,如无地址请先新建地址"),!1;if(""!==this.form.competingGoods&&!/^[\u4E00-\u9FA5a-zA-Z0-9]{1,}$/.test(this.form.competingGoods))return x.a.tip("竞品产品只能输入中英文或数字,不能包含空格"),!1;var e=/^\d{1,}\.{0,1}\d{0,}$/;if(""!==this.form.budget&&!e.test(this.form.budget))return x.a.tip("预算金额必须为数字"),!1;if(""!==this.form.depositPaid&&!e.test(this.form.depositPaid))return x.a.tip("已交定金必须为数字"),!1;return""!==this.form.remark&&/[\ud800-\udbff][\udc00-\udfff]/g.test(this.form.remark)?(this.form.remark=this.form.remark.replace(/[\ud800-\udbff][\udc00-\udfff]/g,""),x.a.tip("备注信息不支持表情"),!1):""===this.form.remark||/^[\u4E00-\u9FA5a-zA-Z0-9\s]{1,}$/.test(this.form.remark)?""===this.form.deliverDate||x.a.compareTimeStamp(this.form.arrivalDate,this.form.deliverDate)||this.form.arrivalDate===this.form.deliverDate?this.form.budget.length>8?(this.form.budget=this.form.budget.substring(0,8),x.a.tip("预算金额不能超过8个字"),!1):this.form.depositPaid.length>8?(this.form.depositPaid=this.form.depositPaid.substring(0,8),x.a.tip("已交定金不能超过8个字"),!1):this.form.competingGoods.length>100?(this.form.competingGoods=this.form.competingGoods.substring(0,100),x.a.tip("竞品产品不能超过100个字"),!1):!(this.form.remark.length>200)||(this.form.remark=this.form.remark.substring(0,200),x.a.tip("备注信息不能超过200个字"),!1):(x.a.tip("需求日期不能小于到店日期"),!1):(x.a.tip("备注信息不支持特殊符号"),!1)},submit:function(){var e=this;if(this.valid()){var t=new FormData,o=this.updateParams(this.form);console.log("obj",o);var s=[];for(var a in o)t.append(a,o[a]),s.push(a);T.updateOpportunity(t,s,o).then(function(t){0==t.code?(x.a.tip(t.msg),e.setCheckedList([]),e.updateSearchProductList([]),e.$router.replace({name:"intention",params:{opportunityId:e.form.oppId}})):x.a.tip(t.msg)})}},updateParams:function(e){var t={};if(e.goodsList.length>0)for(var o=0;o<e.goodsList.length;o++)this.$set(t,"opportunity.goodsList["+o+"].goodsId",e.goodsList[o].goodsId),this.$set(t,"opportunity.goodsList["+o+"].quantity",e.goodsList[o].quantity);var s={customerId:this.customerId,"opportunity.oppId":e.oppId,"opportunity.addressId":e.addressId,"opportunity.shopId":e.shopId,"opportunity.arrivalDate":e.arrivalDate,"opportunity.deliverDate":e.deliverDate,"opportunity.source":e.source,"opportunity.stylePref":e.stylePref,"opportunity.progress":e.progress,"opportunity.colorPref":e.colorPref,"opportunity.competingGoods":e.competingGoods,"opportunity.buyReason":e.buyReason,"opportunity.budget":e.budget,"opportunity.depositPaid":e.depositPaid,"opportunity.argreeDiscount":e.argreeDiscount,"opportunity.remark":e.remark,"opportunity.urgency":e.urgency,"opportunity.level":e.level};for(var a in s)(s[a]||0===s[a])&&(t[a]=s[a]);return t},layerUpdate:function(e){var t=this;if(""!==e){var o=void 0;if("2"===e){if(""===this.failReason)return void x.a.tip("流失原因不能为空");if(this.failReason.length>300)return void x.a.tip("流失原因不能超过300字");var s={opportunityId:this.form.oppId,closeReason:this.failReason,type:e};o=d()({},s)}else{if(""===this.form.deliverDate)return void x.a.tip("需求日期不能为空");if(""===this.phone||"0"===this.phone||0===this.phone)return void x.a.tip("客户手机号码不能为空");var a={opportunityId:this.form.oppId,closeReason:"已成单",type:e};o=d()({},a)}T.closeOpportunity(o).then(function(e){0===e.code?(x.a.tip(e.msg),t.isPrompt=!1,t.$router.go(-1)):(x.a.tip(e.msg),t.isPrompt=!0)}).catch(function(e){510===e&&t.layerUpdate()})}else x.a.tip("请选择是否成单")},layerCancel:function(){this.isPrompt=!1},close:function(){this.isPrompt=!0},openStore:function(){this.$router.push({name:"chooseShop",query:{type:"addintention"}})},updateClassify:function(e){this.form.level=e,console.log("选择"+this.form.level)},updateUrgency:function(e){this.urgency=e,this.form.urgency="是"===e?"true":"false",console.log("选择"+this.urgency)},updateTime:function(e,t){this.form.arrivalDate=t},updateReason:function(e,t){this.buyReasonName=e,this.form.buyReason=t},updateSource:function(e,t){this.sourceName=e,this.form.source=t},updateStyle:function(e,t){this.stylePrefName=e,this.form.stylePref=t},updateProgress:function(e,t){this.progressName=e,this.form.progress=t},updateColor:function(e,t){this.colorPrefName=e,this.form.colorPref=t},updateDeliver:function(e,t){this.form.deliverDate=t},updateDiscount:function(e){console.log(e);var t=e.join(".");t=10*parseFloat(t),console.log(t),this.form.argreeDiscount=t;var o=t/10;this.argreeDiscountTxt=o+"折"},clearKeepAlive:function(){this.form={oppId:"",goodsList:[],addressId:"",shopId:"",arrivalDate:"",budget:"",deliverDate:"",source:"",stylePref:"",progress:"",colorPref:"",competingGoods:"",buyReason:"",depositPaid:"",argreeDiscount:"",remark:"",urgency:"",level:"A",recordList:[]},this.goodsValue="",this.shopName="",this.sourceName="",this.apartmentType="",this.elevator="",this.address="",this.buyReasonName="",this.stylePrefName="",this.progressName="",this.colorPrefName="",this.selectIcon=!0,this.readonly=!1,this.failReason="",this.isPrompt=!1,this.customerId="",this.path="",this.status="",this.urgency="否",this.url="",this.go=-1,this.argreeDiscountTxt=""}}),beforeRouteEnter:function(e,t,o){e.meta.isUseCache||o(function(t){t.customerId=e.params.customerId,t.phone=e.query.phone,t.path=e.fullPath,t.url=e.query.url,t.failReason="",t.getProduct(),t.getShop(),e.query.oppId&&(t.updateTitle("意向详情"),t.form.oppId=e.query.oppId,t.getOpportunity(t.form.oppId))}),o()},beforeRouteLeave:function(e,t,o){"/CustomerInfo"!==e.name&&"/enquiryInfo"!==e.name||(t.meta.isUseCache=!1,this.setCheckedList([]),o()),o()}},O={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"addAdress"},[o("mybanner",{staticStyle:{background:"#f8f8f8"},attrs:{title:e.title}}),e._v(" "),o("title-bar",{attrs:{text:e.titleModule.info}},[o("button",{attrs:{type:"button"},on:{click:e.submit}},[e._v("保存")])]),e._v(" "),o("ul",{staticClass:"list"},[o("li",[o("yan-input",e._b({attrs:{value:e.sleepName,readonly:""}},"yan-input",e.formInfo.sleepName,!1))],1),e._v(" "),o("li",[o("intention-select",e._b({attrs:{value:e.goodsValue,id:e.customerId,url:e.path,showIcon:e.selectIcon}},"intention-select",e.formInfo.intention,!1))],1),e._v(" "),o("li",[o("store-select",e._b({attrs:{value:e.shopName}},"store-select",e.formInfo.store,!1))],1),e._v(" "),o("li",[o("date-select",e._b({attrs:{day:"end",value:e.form.arrivalDate,showIcon:e.selectIcon},on:{update:e.updateTime}},"date-select",e.formInfo.time,!1))],1),e._v(" "),o("li",[o("source-select",e._b({attrs:{value:e.sourceName,showIcon:e.selectIcon},on:{update:e.updateSource}},"source-select",e.formInfo.source,!1))],1),e._v(" "),o("li",[o("date-select",e._b({attrs:{value:e.form.deliverDate,showIcon:e.selectIcon},on:{update:e.updateDeliver}},"date-select",e.formInfo.deliver,!1))],1)]),e._v(" "),o("ul",{staticClass:"list"},[o("li",[o("address-select",e._b({attrs:{value:e.address,id:e.customerId,url:e.path,showIcon:e.selectIcon}},"address-select",e.formInfo.address,!1))],1),e._v(" "),o("li",[o("yan-input",e._b({attrs:{value:e.apartmentType,readonly:!0},on:{click:e.listen}},"yan-input",e.formInfo.house,!1))],1),e._v(" "),o("li",[o("yan-input",e._b({attrs:{value:e.elevator,readonly:!0},on:{click:e.listen}},"yan-input",e.formInfo.elevator,!1))],1),e._v(" "),o("li",[o("reason-select",e._b({attrs:{value:e.buyReasonName,showIcon:e.selectIcon},on:{update:e.updateReason}},"reason-select",e.formInfo.reason,!1))],1),e._v(" "),o("li",[o("style-select",e._b({attrs:{value:e.stylePrefName,showIcon:e.selectIcon},on:{update:e.updateStyle}},"style-select",e.formInfo.style,!1))],1),e._v(" "),o("li",[o("progress-select",e._b({attrs:{value:e.progressName,showIcon:e.selectIcon},on:{update:e.updateProgress}},"progress-select",e.formInfo.progress,!1))],1)]),e._v(" "),o("ul",{staticClass:"list"},[o("li",{staticStyle:{"border-top":"1px solid transparent"}},[o("yan-one-input",e._b({attrs:{readonly:e.readonly,maxlength:100},model:{value:e.form.competingGoods,callback:function(t){e.$set(e.form,"competingGoods","string"==typeof t?t.trim():t)},expression:"form.competingGoods"}},"yan-one-input",e.formInfo.goods,!1))],1),e._v(" "),o("li",[o("color-select",e._b({attrs:{value:e.colorPrefName,showIcon:e.selectIcon},on:{update:e.updateColor}},"color-select",e.formInfo.color,!1))],1),e._v(" "),o("li",[o("yan-input",e._b({attrs:{readonly:e.readonly,maxlength:8},model:{value:e.form.budget,callback:function(t){e.$set(e.form,"budget","string"==typeof t?t.trim():t)},expression:"form.budget"}},"yan-input",e.formInfo.budget,!1))],1),e._v(" "),o("li",[o("yan-input",e._b({attrs:{readonly:e.readonly,maxlength:8},model:{value:e.form.depositPaid,callback:function(t){e.$set(e.form,"depositPaid","string"==typeof t?t.trim():t)},expression:"form.depositPaid"}},"yan-input",e.formInfo.paid,!1))],1),e._v(" "),o("li",[o("discount-select",e._b({attrs:{value:e.argreeDiscountTxt,showIcon:e.selectIcon},on:{update:e.updateDiscount}},"discount-select",e.formInfo.discount,!1))],1)]),e._v(" "),o("yan-textarea",e._b({attrs:{maxlength:200,readonly:e.readonly},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark","string"==typeof t?t.trim():t)},expression:"form.remark"}},"yan-textarea",e.formInfo.remark,!1)),e._v(" "),o("div",{staticClass:"select"},[o("classify-select",{staticStyle:{"margin-bottom":"2.666vw"},attrs:{label:"意向分类",name:"classify",checked:e.form.level,options:e.formInfo.classify},on:{update:e.updateClassify}}),e._v(" "),o("classify-select",{attrs:{label:"是否紧急",name:"urgency",checked:e.urgency,options:e.formInfo.urgency},on:{update:e.updateUrgency}})],1),e._v(" "),o("div",[o("title-bar",{attrs:{text:e.titleModule.report}}),e._v(" "),o("record-pannel",{attrs:{recordList:e.recordList}})],1),e._v(" "),o("p",{staticClass:"last"},[e._v("到底啦")]),e._v(" "),e.isPrompt?o("yan-layer-prompt",{on:{update:e.layerUpdate,cancel:e.layerCancel},model:{value:e.failReason,callback:function(t){e.failReason=t},expression:"failReason"}},[o("span",{attrs:{slot:"update"},slot:"update"},[e._v("确定")]),e._v(" "),o("span",{attrs:{slot:"cancel"},slot:"cancel"},[e._v("取消")])]):e._e()],1)},staticRenderFns:[]};var V=o("C7Lr")(C,O,!1,function(e){o("Vq6V")},"data-v-389b5166",null);t.default=V.exports},Vq6V:function(e,t){}});