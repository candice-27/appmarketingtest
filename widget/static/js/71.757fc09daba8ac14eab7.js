webpackJsonp([71],{"6gpI":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o("4YfN"),r=o.n(s),a=o("aA9S"),i=o.n(a),n=(o("xd7I"),o("YV7O")),d=o("WoPn"),p=o("OVlV"),l=o("ZaQL"),c=o("UaEH"),u=o("otx3"),m=o("T0rX"),f=o("yN+A"),h=o("vRxf"),g=o("TB9H"),y=o("RrjH"),v=o("W4OY"),I=o("ab77"),b=o("ijls"),P=o("+ZJN"),_=o("YVni"),N=o("EfbY"),k=o("l6Gh"),S=o("tqtp"),L=(o("wSez"),o("HVJf")),D=o("vGYV"),$=new(o("0xDb").a),T={data:function(){return{form:{oppId:"",goodsList:[],addressId:"",shopId:"",arrivalDate:"",budget:"",deliverDate:"",residentTime:"",source:"",stylePref:"",progress:"",colorPref:"",competingGoods:"",buyReason:"",depositPaid:"",argreeDiscount:"",remark:"",urgency:"",level:"A",recordList:[]},isFirstEnter:!1,goodsValue:"",shopName:"",sourceName:"",apartmentType:"",elevator:"",address:"",buyReasonName:"",stylePrefName:"",progressName:"",colorPrefName:"",selectIcon:!0,readonly:!1,failReason:"",isPrompt:!1,customerId:"",path:"",status:"",urgency:"否",url:"",go:-1}},components:{mybanner:n.a,yanInput:p.a,yanTextarea:c.a,dateSelect:f.a,titleBar:d.a,intentionSelect:u.a,storeSelect:m.a,durationSelect:h.a,sourceSelect:g.a,addressSelect:y.a,reasonSelect:v.a,styleSelect:I.a,progressSelect:P.a,classifySelect:N.a,recordPannel:k.a,yanLayerPrompt:S.a,colorSelect:b.a,discountSelect:_.a,yanOneInput:l.a},watch:{$route:function(e,t){var o=this;if("selectAddress"===t.name){var s={};if(this.$route.query.addressId){this.$store.state.addressList.map(function(e,t){console.log(e),e.addressId===o.$route.query.addressId&&(console.log("进来了"),s=i()({},e))});var r=""+s.province+s.city+s.district+s.address,a="Y"===s.elevator?"有":"无";this.address=r,this.apartmentType=s.apartmentType,this.elevator=a,this.form.addressId=this.$route.query.addressId}else this.address="未收集地址",this.apartmentType="未收集户型",this.elevator="未收集"}if("intentionProduct"===t.name&&(console.log("进来intentionProduct"),console.log(this.$store.state.checkedList.length),this.$store.state.checkedList.length>0?(this.goodsValue=this.$store.state.checkedList[0].goodsName,this.form.goodsList=this.$store.state.checkedList.map(function(e,t){var o={};return o.goodsId=e.crmId,o.goodsName=e.goodsName,o.quantity=e.quantity,o})):(this.goodsValue="",this.form.goodsList=[])),"chooseShop"===t.name){console.log("进来chooseShop");var n=JSON.parse(localStorage.getItem("shops"));console.log(n),this.go=-2;var d=localStorage.getItem("shopIndex");console.log(d),n.map(function(e,t){d==t&&(o.form.shopId=e.id,o.shopName=e.name)})}}},computed:r()({},Object(L.d)("addIntention",["title","formInfo","titleModule"]),Object(L.d)(["checkedList"])),created:function(){this.updateTitle("新建意向"),this.$route.meta.keepAlive=!0},activated:function(){this.customerId=this.$route.params.customerId,this.path=this.$route.fullPath,this.url=this.$route.query.url,console.log(this.checkedList),this.getProduct(),this.getShop(),console.log("回退进了created"),this.isFirstEnter=!0},mounted:function(){},methods:r()({},Object(L.c)("addIntention",["updateTitle"]),Object(L.c)(["updateAddress","setCheckedList","updateSearchProductList"]),{getShop:function(){var e=this,t=JSON.parse(localStorage.getItem("shops"));console.log(t);var o=localStorage.getItem("shopIndex");console.log(o),t.map(function(t,s){o==s&&(e.form.shopId=t.id,e.shopName=t.name)})},getProduct:function(){this.$store.state.checkedList.length<=0?(this.goodsValue="",this.form.goodsList=[]):(this.goodsValue=this.$store.state.checkedList[0].goodsName,this.form.goodsList=this.$store.state.checkedList.map(function(e,t){var o={};return o.goodsId=e.crmId,o.goodsName=e.goodsName,o.quantity=e.quantity,o}))},addRecord:function(){this.$router.replace({name:"followRecord",query:{oppId:this.oppId}})},listen:function(){""===this.form.address&&D.a.tip("请先选择地址")},getAddress:function(e){var t=this;$.getAddress(e).then(function(e){0===e.code?(t.address=""+e.data.provinceName+e.data.cityName+e.data.districtName+e.data.address,t.apartmentType=e.data.apartmentTypeName,t.elevator="Y"===e.data.elevator?"有电梯":"无电梯"):D.a.tip(e.msg)}).catch(function(o){510===o&&t.getAddress(e)})},getShopName:function(e){var t=localStorage.getItem("shops"),o=void 0;return JSON.parse(t).map(function(t,s){if(t.id===e)return o=t.name}),o},valid:function(){if(""===this.customerId)return D.a.tip("客户ID不能为空"),!1;if(this.form.goodsList.length<=0)return D.a.tip("意向产品不能为空"),!1;if(""===this.form.arrivalDate)return D.a.tip("进店日期不能为空"),!1;if(""===this.form.shopId)return D.a.tip("门店不能为空"),!1;if(""===this.form.residentTime)return D.a.tip("留店时长不能为空"),!1;if(""===this.form.source)return D.a.tip("客户来源不能为空"),!1;if(""===this.form.addressId)return D.a.tip("请选择地址,如无地址请先新建地址"),!1;var e=/^\d{1,}\.{0,1}\d{0,}$/;return""===this.form.budget||e.test(this.form.budget)?""===this.form.depositPaid||e.test(this.form.depositPaid)?""===this.form.deliverDate||D.a.compareTimeStamp(this.form.arrivalDate,this.form.deliverDate)?this.form.budget.length>8?(this.form.budget=this.form.budget.substring(0,8),D.a.tip("预算金额不能超过8个字"),!1):this.form.depositPaid.length>8?(this.form.depositPaid=this.form.depositPaid.substring(0,8),D.a.tip("已交定金不能超过8个字"),!1):this.form.competingGoods.length>100?(this.form.competingGoods=this.form.competingGoods.substring(0,100),D.a.tip("竞品产品不能超过100个字"),!1):!(this.form.remark.length>200)||(this.form.remark=this.form.remark.substring(0,200),D.a.tip("备注信息不能超过200个字"),!1):(D.a.tip("需求日期不能小于到店日期"),!1):(D.a.tip("已交定金必须为数字"),!1):(D.a.tip("预算金额必须为数字"),!1)},submit:function(){var e=this;if(this.valid()){var t=[],o=new FormData;if(o.append("customerId",this.customerId),o.append("opportunity.oppId",this.form.oppId),this.form.goodsList.length>0)for(var s=0;s<this.form.goodsList.length;s++)o.append("opportunity.goodsList["+s+"].goodsId",this.form.goodsList[s].goodsId),o.append("opportunity.goodsList["+s+"].quantity",this.form.goodsList[s].quantity),t.push("opportunity.goodsList["+s+"].goodsId"),t.push("opportunity.goodsList["+s+"].quantity");o.append("opportunity.addressId",this.form.addressId),o.append("opportunity.shopId",this.form.shopId),o.append("opportunity.arrivalDate",this.form.arrivalDate),o.append("opportunity.deliverDate",this.form.deliverDate),o.append("opportunity.residentTime",this.form.residentTime),o.append("opportunity.source",this.form.source),o.append("opportunity.stylePref",this.form.stylePref),o.append("opportunity.progress",this.form.progress),o.append("opportunity.colorPref",this.form.colorPref),o.append("opportunity.competingGoods",this.form.competingGoods),o.append("opportunity.buyReason",this.form.buyReason),o.append("opportunity.budget",this.form.budget),o.append("opportunity.depositPaid",this.form.depositPaid),o.append("opportunity.argreeDiscount",this.form.argreeDiscount),o.append("opportunity.remark",this.form.remark),o.append("opportunity.urgency",this.form.urgency),o.append("opportunity.level",this.form.level);for(var r=[].concat(t,["customerId","opportunity.oppId","opportunity.addressId","opportunity.shopId","opportunity.arrivalDate","opportunity.deliverDate","opportunity.residentTime","opportunity.source","opportunity.stylePref","opportunity.progress","opportunity.colorPref","opportunity.competingGoods","opportunity.buyReason","opportunity.budget","opportunity.depositPaid","opportunity.argreeDiscount","opportunity.remark","opportunity.urgency","opportunity.level"]),a=[],i=0;i<r.length;i++)""!==o.get(r[i])?a.push(r[i]):o.delete(r[i]);$.updateOpportunity(o,[].concat(a)).then(function(t){0==t.code?(D.a.tip(t.msg),e.setCheckedList([]),e.updateSearchProductList([]),e.$destroy(),e.$router.back(e.go),console.log("执行了")):D.a.tip(t.msg)})}},openStore:function(){this.$router.push({name:"chooseShop",query:{type:"addintention"}})},updateClassify:function(e){this.form.level=e,console.log("选择"+this.form.level)},updateUrgency:function(e){this.urgency=e,this.form.urgency="是"===e?"true":"false",console.log("选择"+this.urgency)},updateTime:function(e,t){this.form.arrivalDate=t},updateDuration:function(e){console.log(e),this.form.residentTime=e||"0分钟"},updateReason:function(e,t){this.buyReasonName=e,this.form.buyReason=t},updateSource:function(e,t){this.sourceName=e,this.form.source=t},updateStyle:function(e,t){this.stylePrefName=e,this.form.stylePref=t},updateProgress:function(e,t){this.progressName=e,this.form.progress=t},updateColor:function(e,t){this.colorPrefName=e,this.form.colorPref=t},updateDeliver:function(e,t){this.form.deliverDate=t},updateDiscount:function(e){console.log(e);var t=e.join(".");t=10*parseFloat(t),console.log(t),this.form.argreeDiscount=t},clearKeepAlive:function(){this.form={oppId:"",goodsList:[],addressId:"",shopId:"",arrivalDate:"",budget:"",deliverDate:"",residentTime:"",source:"",stylePref:"",progress:"",colorPref:"",competingGoods:"",buyReason:"",depositPaid:"",argreeDiscount:"",remark:"",urgency:"",level:"A",recordList:[]},this.goodsValue="",this.shopName="",this.sourceName="",this.apartmentType="",this.elevator="",this.address="",this.buyReasonName="",this.stylePrefName="",this.progressName="",this.colorPrefName="",this.selectIcon=!0,this.readonly=!1,this.failReason="",this.isPrompt=!1,this.customerId="",this.path="",this.status="",this.urgency="否",this.url="",this.go=-1}}),beforeRouteLeave:function(e,t,o){console.log(e.name),"/enquiryInfo"===e.name&&(t.meta.keepAlive||(this.clearKeepAlive(),this.$destroy(),o())),"/CustomerInfo"===e.name&&(t.meta.keepAlive||(this.clearKeepAlive(),this.$destroy(),o()),o()),o()}},w={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"addAdress"},[o("mybanner",{staticStyle:{background:"#f8f8f8"},attrs:{title:e.title}},[o("button",{attrs:{type:"button"},on:{click:e.submit}},[e._v("保存")])]),e._v(" "),o("title-bar",{attrs:{text:e.titleModule.info}}),e._v(" "),o("ul",{staticClass:"list"},[o("li",[o("intention-select",e._b({attrs:{value:e.goodsValue,id:e.customerId,url:e.path,showIcon:e.selectIcon}},"intention-select",e.formInfo.intention,!1))],1),e._v(" "),o("li",{on:{click:e.openStore}},[o("store-select",e._b({attrs:{value:e.shopName,showIcon:e.selectIcon}},"store-select",e.formInfo.store,!1))],1),e._v(" "),o("li",[o("date-select",e._b({attrs:{value:e.form.arrivalDate,showIcon:e.selectIcon},on:{update:e.updateTime}},"date-select",e.formInfo.time,!1))],1),e._v(" "),o("li",[o("duration-select",e._b({attrs:{value:e.form.residentTime,showIcon:e.selectIcon},on:{update:e.updateDuration}},"duration-select",e.formInfo.duration,!1))],1),e._v(" "),o("li",[o("source-select",e._b({attrs:{value:e.sourceName,showIcon:e.selectIcon},on:{update:e.updateSource}},"source-select",e.formInfo.source,!1))],1)]),e._v(" "),o("ul",{staticClass:"list"},[o("li",[o("address-select",e._b({attrs:{value:e.address,id:e.customerId,url:e.path,showIcon:e.selectIcon}},"address-select",e.formInfo.address,!1))],1),e._v(" "),o("li",[o("yan-input",e._b({attrs:{value:e.apartmentType,readonly:!0},on:{click:e.listen}},"yan-input",e.formInfo.house,!1))],1),e._v(" "),o("li",[o("yan-input",e._b({attrs:{value:e.elevator,readonly:!0},on:{click:e.listen}},"yan-input",e.formInfo.elevator,!1))],1),e._v(" "),o("li",[o("reason-select",e._b({attrs:{value:e.buyReasonName,showIcon:e.selectIcon},on:{update:e.updateReason}},"reason-select",e.formInfo.reason,!1))],1),e._v(" "),o("li",[o("style-select",e._b({attrs:{value:e.stylePrefName,showIcon:e.selectIcon},on:{update:e.updateStyle}},"style-select",e.formInfo.style,!1))],1),e._v(" "),o("li",[o("progress-select",e._b({attrs:{value:e.progressName,showIcon:e.selectIcon},on:{update:e.updateProgress}},"progress-select",e.formInfo.progress,!1))],1)]),e._v(" "),o("ul",{staticClass:"list"},[o("li",[o("yan-one-input",e._b({attrs:{readonly:e.readonly,maxlength:100},model:{value:e.form.competingGoods,callback:function(t){e.$set(e.form,"competingGoods","string"==typeof t?t.trim():t)},expression:"form.competingGoods"}},"yan-one-input",e.formInfo.goods,!1))],1),e._v(" "),o("li",[o("color-select",e._b({attrs:{value:e.colorPrefName,showIcon:e.selectIcon},on:{update:e.updateColor}},"color-select",e.formInfo.color,!1))],1),e._v(" "),o("li",[o("yan-input",e._b({attrs:{readonly:e.readonly,maxlength:8},model:{value:e.form.budget,callback:function(t){e.$set(e.form,"budget","string"==typeof t?t.trim():t)},expression:"form.budget"}},"yan-input",e.formInfo.budget,!1))],1),e._v(" "),o("li",[o("date-select",e._b({attrs:{value:e.form.deliverDate,showIcon:e.selectIcon},on:{update:e.updateDeliver}},"date-select",e.formInfo.deliver,!1))],1),e._v(" "),o("li",[o("yan-input",e._b({attrs:{readonly:e.readonly,maxlength:8},model:{value:e.form.depositPaid,callback:function(t){e.$set(e.form,"depositPaid","string"==typeof t?t.trim():t)},expression:"form.depositPaid"}},"yan-input",e.formInfo.paid,!1))],1),e._v(" "),o("li",[o("discount-select",e._b({attrs:{value:e.form.argreeDiscount,showIcon:e.selectIcon},on:{update:e.updateDiscount}},"discount-select",e.formInfo.discount,!1))],1)]),e._v(" "),o("yan-textarea",e._b({attrs:{maxlength:200,readonly:e.readonly},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}},"yan-textarea",e.formInfo.remark,!1)),e._v(" "),o("div",{staticClass:"select"},[o("classify-select",{staticStyle:{"margin-bottom":"2.666vw"},attrs:{label:"意向分类",name:"classify",checked:e.form.level,options:e.formInfo.classify},on:{update:e.updateClassify}}),e._v(" "),o("classify-select",{attrs:{label:"是否紧急",name:"urgency",checked:e.urgency,options:e.formInfo.urgency},on:{update:e.updateUrgency}})],1)],1)},staticRenderFns:[]};var R=o("C7Lr")(T,w,!1,function(e){o("w4A+")},"data-v-beba489e",null);t.default=R.exports},"w4A+":function(e,t){}});
//# sourceMappingURL=71.757fc09daba8ac14eab7.js.map