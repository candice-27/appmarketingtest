webpackJsonp([68],{NTh3:function(e,t){},ZrXa:function(e,t){},cHVA:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("4YfN"),i=o.n(r),a=o("xd7I"),n=o("YV7O"),s=o("fzaL"),l=o("OVlV"),f=o("UaEH"),c=o("wSez"),p=o("0xDb");a.default.component(c.Picker.name,c.Picker),a.default.component(c.Popup.name,c.Popup);new p.a;var m={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"inputBox"},[r("label",{on:{click:e.open}},[r("span",[e._v(e._s(e.label)),r("span",{directives:[{name:"show",rawName:"v-show",value:e.required,expression:"required"}],staticClass:"yan-red"},[e._v("*")])]),e._v(" "),r("input",{attrs:{type:"text",readonly:"",placeholder:e.placeholder},domProps:{value:e.value},on:{input:function(t){return e.$emit("input",t.target.value)}}})]),e._v(" "),e.showIcon?r("div",{staticClass:"icon-right"},[r("img",{attrs:{src:o("4ral"),alt:""}})]):e._e(),e._v(" "),r("mt-popup",{attrs:{position:"bottom"},model:{value:e.popupVisible,callback:function(t){e.popupVisible=t},expression:"popupVisible"}},[r("mt-picker",{attrs:{slots:e.slots,showToolbar:!0,"value-key":"name"},on:{change:e.onValuesChange}},[r("div",{staticClass:"btn-group"},[r("div",{on:{click:e.cancel}},[e._v("取消")]),e._v(" "),r("div",{on:{click:e.update}},[e._v("确定")])])])],1)],1)},staticRenderFns:[]};var u=o("C7Lr")({props:["value","label","placeholder","showIcon","required"],data:function(){return{popupVisible:!1,slots:[{flex:1,values:["到店沟通","电话沟通","微信沟通"],className:"slot1",textAlign:"center"}],arr:[]}},mounted:function(){},methods:{onValuesChange:function(e,t){this.arr=e.getValues()},open:function(){this.popupVisible=!0},cancel:function(){this.popupVisible=!1},update:function(){this.$emit("update",this.arr),this.popupVisible=!1}}},m,!1,function(e){o("ZrXa")},"data-v-6fd0c8ee",null).exports,d=o("yN+A"),h=o("90w1"),v=o("vRxf"),b=o("HVJf"),x=o("vGYV");a.default.component(c.Picker.name,c.Picker);var w=new p.a,T={data:function(){return{form:{follow:"到店沟通",time:"",residentTime:"",report:"",nextTime:"",plan:""},selectIcon:!0,oppId:"",isClear:!0,path:"/followRecord"}},components:{mybanner:n.a,Btn:s.a,yanInput:l.a,yanTextarea:f.a,followSelect:u,dateSelect:d.a,upload:h.a,durationSelect:v.a},watch:{$route:function(e,t){}},computed:i()({},Object(b.d)("followRecord",["title","formInfo"]),Object(b.d)(["Files"])),activated:function(){this.$route.meta.isUseCache||(this.oppId=this.$route.query.oppId)},methods:i()({},Object(b.c)(["setFiles","setPicVal"]),{valid:function(){if(""===this.form.oppId)return x.a.tip("意向ID不能为空"),!1;if(""===this.form.follow)return x.a.tip("请选择跟进方式"),!1;if(""===this.form.time)return x.a.tip("请选择跟进时间"),!1;if(""===this.form.residentTime)return x.a.tip("请选择跟进时长"),!1;if(""===this.form.report)return x.a.tip("请填写本次跟进情况"),!1;if(this.form.nextTime&&!x.a.compareTimeStamp(this.form.time,this.form.nextTime)&&this.form.time!==this.form.nextTime)return x.a.tip("下次跟进时间不能小于当前跟进时间"),!1;var e=/[\ud800-\udbff][\udc00-\udfff]/g,t=/^[\u4E00-\u9FA5a-zA-Z0-9\s]{1,}$/;return this.form.report.length>300?(this.form.report=this.form.report.substring(0,300),x.a.tip("跟进情况不能超过300字"),!1):e.test(this.form.report)?(this.form.report=this.changeStr(this.form.report),x.a.tip("跟进情况不支持表情"),!1):t.test(this.form.report)?this.form.plan.length>300?(this.form.plan=this.form.plan.substring(0,300),x.a.tip("跟进计划不能超过300字"),!1):""!==this.form.plan&&e.test(this.form.plan)?(this.form.plan=this.changeStr(this.form.plan),x.a.tip("跟进计划不支持表情"),!1):!(""!==this.form.plan&&!t.test(this.form.plan))||(x.a.tip("跟进计划不支持特殊符号"),!1):(x.a.tip("跟进情况不支持特殊符号"),!1)},changeStr:function(e){return e.replace(/[\ud800-\udbff][\udc00-\udfff]/g,"")},update:function(){var e=this;if(this.valid()){var t=new FormData;if(this.Files.length>0)for(var o=0;o<this.Files.length;o++)t.append("record.dataFile",this.Files[o]);var r=this.updateParams(this.form),i=[];for(var a in r)t.append(a,r[a]),i.push(a);console.log(i),console.log(r),w.updateTrackrecord(t,i,r).then(function(t){0===t.code?(x.a.tip("提交成功"),e.setFiles([]),e.setPicVal([]),e.isClear=!0,e.form.follow="",e.form.time="",e.form.residentTime="",e.form.nextTime="",e.form.report="",e.form.plan="",e.$router.back(-1)):(x.a.tip(t.msg),e.setFiles([]),e.setPicVal([]),e.isClear=!0,e.form.follow="",e.form.time="",e.form.residentTime="",e.form.nextTime="",e.form.report="",e.form.plan="")}).catch(function(t){510===t&&e.update()})}},updateParams:function(e){var t={},o={"opportunity.oppId":this.oppId,"record.source":e.follow,"record.residentTime":e.residentTime,"record.followDate":e.time,"record.nextDate":e.nextTime,"record.situation":e.report,"record.plan":e.plan};for(var r in o)(o[r]||0===o[r])&&(t[r]=o[r]);return t},updateTime:function(e,t){this.$set(this.form,"time",t)},updateNextTime:function(e,t){this.$set(this.form,"nextTime",t)},updateResidentTime:function(e){console.log(e),this.form.residentTime=e||"0分钟"},updateFollow:function(e){this.form.follow=e[0]}}),beforeRouteEnter:function(e,t,o){e.meta.isUseCache?o():o(function(e){e.setFiles([]),e.setPicVal([]),e.isClear=!0,e.form.follow="到店沟通",e.form.time=x.a.indexTimeB(new Date)[1],e.form.residentTime="",e.form.nextTime="",e.form.report="",e.form.plan=""})}},_={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"addAdress"},[o("mybanner",{staticStyle:{background:"#f8f8f8"},attrs:{title:e.title}},[o("button",{attrs:{type:"button"},on:{click:e.update}},[e._v("保存")])]),e._v(" "),o("ul",{staticClass:"list"},[o("li",[o("follow-select",e._b({staticClass:"li_border",attrs:{showIcon:e.selectIcon},on:{update:e.updateFollow},model:{value:e.form.follow,callback:function(t){e.$set(e.form,"follow",t)},expression:"form.follow"}},"follow-select",e.formInfo.follow,!1))],1),e._v(" "),o("li",[o("date-select",e._b({staticClass:"li_border",attrs:{day:"end",showIcon:e.selectIcon},on:{update:e.updateTime},model:{value:e.form.time,callback:function(t){e.$set(e.form,"time",t)},expression:"form.time"}},"date-select",e.formInfo.time,!1))],1),e._v(" "),o("li",[o("duration-select",e._b({attrs:{showIcon:e.selectIcon},on:{update:e.updateResidentTime},model:{value:e.form.residentTime,callback:function(t){e.$set(e.form,"residentTime",t)},expression:"form.residentTime"}},"duration-select",e.formInfo.duration,!1))],1)]),e._v(" "),o("yan-textarea",e._b({attrs:{maxlength:300},model:{value:e.form.report,callback:function(t){e.$set(e.form,"report","string"==typeof t?t.trim():t)},expression:"form.report"}},"yan-textarea",e.formInfo.report,!1)),e._v(" "),o("div",{staticClass:"next"},[o("date-select",e._b({attrs:{showIcon:e.selectIcon},on:{update:e.updateNextTime},model:{value:e.form.nextTime,callback:function(t){e.$set(e.form,"nextTime",t)},expression:"form.nextTime"}},"date-select",e.formInfo.nextTime,!1))],1),e._v(" "),o("yan-textarea",e._b({attrs:{maxlength:300},model:{value:e.form.plan,callback:function(t){e.$set(e.form,"plan","string"==typeof t?t.trim():t)},expression:"form.plan"}},"yan-textarea",e.formInfo.plan,!1)),e._v(" "),o("p",{staticClass:"title"},[e._v("附件图片")]),e._v(" "),o("upload",{ref:"upload",attrs:{picLen:"5",clear:e.isClear,path:e.path}})],1)},staticRenderFns:[]};var g=o("C7Lr")(T,_,!1,function(e){o("NTh3")},"data-v-086079dd",null);t.default=g.exports}});
//# sourceMappingURL=68.291ba0bcd2b5d92fb4c3.js.map