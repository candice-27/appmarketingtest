webpackJsonp([28],{"7Ao1":function(e,t){},OFNj:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=s("4YfN"),o=s.n(n),a=s("vGYV"),i=s("HVJf"),r=s("TYi7"),c=s("YV7O"),l=s("CNcc"),u={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"radio"},[s("div",{staticClass:"comp"},[s("input",{attrs:{type:"radio",name:"radioComp",id:e.textVal.id},domProps:{value:e.textVal.name,checked:1==e.textVal.id},on:{change:e.updataInp,input:function(t){return e.$emit("input",t.target.value)}}}),e._v(" "),s("label",{attrs:{for:e.textVal.id}},[s("p",{staticClass:"one"},[e._v(e._s(e.textVal.name))])])])])},staticRenderFns:[]};var h=s("C7Lr")({props:["textVal"],methods:{updataInp:function(e){this.$emit("change",e.target.value)}}},u,!1,function(e){s("ohT3")},"data-v-092bcdf0",null).exports,p={props:["status"],data:function(){return{shopList:[],check:"",isOn:!1}},computed:{picked:function(){var e=this,t=void 0;return this.shopList.map(function(s,n){s.crmId===e.check&&(t=s)}),t}},created:function(){var e=localStorage.getItem("shops");this.shopList=JSON.parse(e),this.check=this.shopList[0].crmId},methods:{updateShop:function(e){this.isOn=!1,this.$emit("change",e.target.value)},changeStatus:function(){this.isOn=!this.isOn}}},m={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"shop"},[n("div",{staticClass:"shopList",class:e.isOn&&e.status?"on":""},[n("div",{staticClass:"shopLi"},[n("label",{on:{click:e.changeStatus}},[n("span",[e._v(e._s(e.picked.name))]),e._v(" "),n("img",{staticClass:"down",attrs:{src:s("lHPd"),alt:""}})])]),e._v(" "),e._l(e.shopList,function(t){return n("div",{key:t.crmId,staticClass:"shopLi"},[n("label",[n("span",[e._v(e._s(t.name))]),e._v(" "),n("img",{directives:[{name:"show",rawName:"v-show",value:e.check===t.crmId,expression:"check===item.crmId"}],staticClass:"get",attrs:{src:s("p6jp"),alt:""}}),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.check,expression:"check"}],attrs:{type:"radio"},domProps:{value:t.crmId,checked:e._q(e.check,t.crmId)},on:{change:[function(s){e.check=t.crmId},e.updateShop]}})])])})],2)])},staticRenderFns:[]};var d=s("C7Lr")(p,m,!1,function(e){s("z4EY")},"data-v-5cd0a450",null).exports,v={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"selectTips"},[s("div",{staticClass:"content"},[s("p",[e._v(e._s(e.tipsVal))]),e._v(" "),s("p",[e._v("是否前往维护客户？")])]),e._v(" "),s("div",{staticClass:"btn"},[s("button",{staticClass:"cancle",on:{click:e.cancle}},[e._v("取消")]),e._v(" "),s("button",{staticClass:"comfirm",on:{click:e.comfirm}},[e._v("前往")])])])},staticRenderFns:[]};var f={name:"customerSearch",components:{radioComp:h,selectTips:s("C7Lr")({props:["btnSelect","tipsVal"],methods:{cancle:function(){this.btnSelect(!1)},comfirm:function(){this.btnSelect(!0)}}},v,!1,function(e){s("o8Vv")},"data-v-41f76740",null).exports,chooseShop:d},data:function(){return{phone:"",radioVal:"",text:[{name:"客户手机",id:1},{name:"客户微信",id:2}],chooseVal:"请输入客户手机号",existStatus:!1,cusId:"",tipsVal:"手机号码已存在，",inpType:"",pressType:"",status:!0,orgId:""}},watch:{radioVal:function(){this.chooseVal="客户手机"==this.radioVal?"请输入客户手机号":"请输入客户微信号",this.inpType="客户手机"==this.radioVal?"number":"text",this.tipsVal="客户手机"==this.radioVal?"手机号码已存在，":"微信号已存在，"}},created:function(){this.orgId=JSON.parse(localStorage.getItem("shops"))[0].crmId},mounted:function(){this.radioVal=this.text[0].name},methods:{myFunction:function(e){console.log(e.keyCode),e.keyCode},toCustomerInfo:function(){var e="客户手机"===this.radioVal?"phone":"wechat";"phone"===e?this.phoneTest(e):this.weChatText()&&this.sendPhoneTest(e)},weChatText:function(){var e=void 0;return/^[a-zA-Z]([-_a-zA-Z0-9]{5,19})+$/.test(this.phone)?e=!0:(a.a.tip("请输入正确的微信号"),e=!1),e},phoneTest:function(e){l.a.testPhone(this.phone)?this.sendPhoneTest(e):a.a.tip("请填写正确的手机号码")},sendPhoneTest:function(e){var t=this;a.a.getAjax("/v3/app/customer/check",{value:this.phone,type:e,orgId:this.orgId}).then(function(s){(s=s.data)?(t.existStatus=!0,t.cusId=s.customerId):t.$router.push({path:"/newCustomerInfo?"+e+"="+t.phone+"&orgId="+t.orgId})}).catch(function(s){510===s&&t.sendPhoneTest(e)})},changeVal:function(e){this.radioVal=e},btnSelect:function(e){e&&this.$router.replace({path:"/customerInfo",query:{id:this.cusId}}),this.existStatus=!1},updateShop:function(e){this.orgId=e},changeStatus:function(){this.status=!1},close:function(){this.status=!0}}},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"customerSearch"},[s("div",{staticClass:"radio"},e._l(e.text,function(t,n){return s("radioComp",{key:n,attrs:{textVal:t},on:{change:e.changeVal},model:{value:e.radioVal,callback:function(t){e.radioVal=t},expression:"radioVal"}})}),1),e._v(" "),s("div",{staticClass:"inp"},["checkbox"===e.inpType?s("input",{directives:[{name:"model",rawName:"v-model",value:e.phone,expression:"phone"},{name:"show",rawName:"v-show",value:"number"==e.inpType,expression:'inpType=="number"'}],attrs:{placeholder:e.chooseVal,onkeypress:"if(event.keyCode == 101){return false}",type:"checkbox"},domProps:{checked:Array.isArray(e.phone)?e._i(e.phone,null)>-1:e.phone},on:{focus:e.changeStatus,blur:e.close,change:function(t){var s=e.phone,n=t.target,o=!!n.checked;if(Array.isArray(s)){var a=e._i(s,null);n.checked?a<0&&(e.phone=s.concat([null])):a>-1&&(e.phone=s.slice(0,a).concat(s.slice(a+1)))}else e.phone=o}}}):"radio"===e.inpType?s("input",{directives:[{name:"model",rawName:"v-model",value:e.phone,expression:"phone"},{name:"show",rawName:"v-show",value:"number"==e.inpType,expression:'inpType=="number"'}],attrs:{placeholder:e.chooseVal,onkeypress:"if(event.keyCode == 101){return false}",type:"radio"},domProps:{checked:e._q(e.phone,null)},on:{focus:e.changeStatus,blur:e.close,change:function(t){e.phone=null}}}):s("input",{directives:[{name:"model",rawName:"v-model",value:e.phone,expression:"phone"},{name:"show",rawName:"v-show",value:"number"==e.inpType,expression:'inpType=="number"'}],attrs:{placeholder:e.chooseVal,onkeypress:"if(event.keyCode == 101){return false}",type:e.inpType},domProps:{value:e.phone},on:{focus:e.changeStatus,blur:e.close,input:function(t){t.target.composing||(e.phone=t.target.value)}}}),e._v(" "),"checkbox"===e.inpType?s("input",{directives:[{name:"model",rawName:"v-model",value:e.phone,expression:"phone"},{name:"show",rawName:"v-show",value:"text"==e.inpType,expression:'inpType=="text"'}],attrs:{placeholder:e.chooseVal,oninput:"if(value.length>20)value=value.slice(0,20)",type:"checkbox"},domProps:{checked:Array.isArray(e.phone)?e._i(e.phone,null)>-1:e.phone},on:{focus:e.changeStatus,blur:e.close,change:function(t){var s=e.phone,n=t.target,o=!!n.checked;if(Array.isArray(s)){var a=e._i(s,null);n.checked?a<0&&(e.phone=s.concat([null])):a>-1&&(e.phone=s.slice(0,a).concat(s.slice(a+1)))}else e.phone=o}}}):"radio"===e.inpType?s("input",{directives:[{name:"model",rawName:"v-model",value:e.phone,expression:"phone"},{name:"show",rawName:"v-show",value:"text"==e.inpType,expression:'inpType=="text"'}],attrs:{placeholder:e.chooseVal,oninput:"if(value.length>20)value=value.slice(0,20)",type:"radio"},domProps:{checked:e._q(e.phone,null)},on:{focus:e.changeStatus,blur:e.close,change:function(t){e.phone=null}}}):s("input",{directives:[{name:"model",rawName:"v-model",value:e.phone,expression:"phone"},{name:"show",rawName:"v-show",value:"text"==e.inpType,expression:'inpType=="text"'}],attrs:{placeholder:e.chooseVal,oninput:"if(value.length>20)value=value.slice(0,20)",type:e.inpType},domProps:{value:e.phone},on:{focus:e.changeStatus,blur:e.close,input:function(t){t.target.composing||(e.phone=t.target.value)}}})]),e._v(" "),s("chooseShop",{attrs:{status:e.status},on:{change:e.updateShop}}),e._v(" "),s("div",{staticClass:"btn"},[s("button",{attrs:{type:"button"},on:{click:e.toCustomerInfo}},[e._v("新建")])]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.existStatus,expression:"existStatus"}],staticClass:"tips"},[s("selectTips",{staticClass:"tips_box",attrs:{btnSelect:e.btnSelect,tipsVal:e.tipsVal}})],1)],1)},staticRenderFns:[]};var C=s("C7Lr")(f,g,!1,function(e){s("U03w")},"data-v-81a4f6c4",null).exports,w=s("0xDb"),b=s("xd7I"),S=s("wSez"),k=s("zdYc"),I=s("2wM2"),y=s("WdeC"),x=s("8BZo"),_=s("oelh"),V=new w.a;b.default.component(S.Picker.name,S.Picker),b.default.component(S.Popup.name,S.Popup),b.default.component(S.DatetimePicker.name,S.DatetimePicker);var N={name:"visitor",props:["fromName"],components:{customerLi:y.a,bigBtn:x.a,remark:_.a,leaveStoreSelect:k.a,shopSelect:I.a},data:function(){return{info:{percent:50},slots:[],proto:"",popupVisible:!1,shopNameList:[{values:[]}],shopName:"",shopId:"",today:new Date,shops:[],Time:"",timeColor:"color: #999"}},created:function(){var e=localStorage.getItem("shops");this.shops=JSON.parse(e),this.Time=a.a.indexTimeB(this.today)[1]},watch:{fromName:function(){"chooseShop"===this.fromName?this.timeColor=this.newCustomerInfo.arrivalDate?"color: #363636":"color: #999":this.initData();var e=this.getShopVal();this.getShopId(e)}},computed:o()({},Object(i.d)({leaveStoreVal:function(e){return e.select.leaveStoreVal},shopList:function(e){return e.chooseShop.shopList},newCustomerInfo:function(e){return e.customer.newCustomerInfo}})),methods:o()({},Object(i.c)(["setLeaveStoreVal","setNewCustomerInfo"]),{initData:function(){this.setNewCustomerInfo({}),this.setLeaveStoreVal("")},getShopVal:function(){var e=void 0;return this.shopList&&this.shopList.length&&this.shopList.forEach(function(t,s){t.status&&(e=t.name)}),e},getShopId:function(e){var t=this;this.shops&&this.shops.length&&this.shops.forEach(function(s,n){s.name===e&&(t.shopId=s.id)}),this.newCustomerInfo.shopId=this.shopId,this.setNewCustomerInfo(this.newCustomerInfo)},selectStoreDate:function(){this.$refs.datePicker.open()},setStoreDate:function(e){this.timeColor="color: #363636",this.$set(this.newCustomerInfo,"arrivalDate",a.a.indexTimeB(e)[1]),this.setNewCustomerInfo(this.newCustomerInfo)},leaveStoreChange:function(e){this.setLeaveStoreVal(e),this.newCustomerInfo.residentTime=e,this.setNewCustomerInfo(this.newCustomerInfo)},saveCustomerInfo:function(){var e=this,t=this.getParmas();V.getVisitor(t,"post").then(function(t){1===t.status&&S.MessageBox.alert("保存成功！").then(function(t){e.$router.replace("/Customer")})}).catch(function(t){510===t&&e.saveCustomerInfo()})},getParmas:function(){var e={"opportunity.residentTime":this.newCustomerInfo.residentTime,"opportunity.shopId":this.newCustomerInfo.shopId,"opportunity.arrivalDate":this.newCustomerInfo.arrivalDate||this.Time,remark:this.newCustomerInfo.remark},t={};for(var s in e)e[s]&&(t[s]=e[s]);return t},turnDate:function(e){if(e){var t=e.split("-");return t.length>1?t[0]+"年"+t[1]+"月"+t[2]+"日":e}}})},T={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"visitor"},[s("ul",[s("leaveStoreSelect",{tag:"li",on:{leaveStoreChange:e.leaveStoreChange}}),e._v(" "),s("customerLi",{tag:"li",attrs:{leftText:"进店日期",icon:!0},nativeOn:{click:function(t){return e.selectStoreDate(t)}}},[s("span",{style:e.timeColor},[e._v(e._s(e.newCustomerInfo.arrivalDate||e.Time))])]),e._v(" "),s("shopSelect",{tag:"li"}),e._v(" "),s("li",{staticClass:"textarea"},[s("remark",{attrs:{title:"备注"}},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.newCustomerInfo.remark,expression:"newCustomerInfo.remark"}],attrs:{name:"",id:"",placeholder:"描述一下情况吧",oninput:"if(value.length>5)value=value.slice(0,200)"},domProps:{value:e.newCustomerInfo.remark},on:{input:function(t){t.target.composing||e.$set(e.newCustomerInfo,"remark",t.target.value)}}})])],1),e._v(" "),s("li",{staticClass:"saveBtn"},[s("big-btn",{staticClass:"myBtn",attrs:{text:"保存"},nativeOn:{click:function(t){return e.saveCustomerInfo(t)}}})],1)],1),e._v(" "),s("mt-datetime-picker",{ref:"datePicker",attrs:{type:"date",startDate:new Date("1930-01-01"),"year-format":"{value} 年","month-format":"{value} 月","date-format":"{value} 日"},on:{confirm:e.setStoreDate},model:{value:e.today,callback:function(t){e.today=t},expression:"today"}})],1)},staticRenderFns:[]};var A=s("C7Lr")(N,T,!1,function(e){s("7Ao1")},"data-v-1f067cde",null).exports,P={name:"newCustomer",components:{myBanner:c.a,customerSearch:C,visitor:A},data:function(){return{btnlist:"",fromName:""}},beforeRouteEnter:function(e,t,s){s(function(e){e.fromName=t.name,"/NewCustomerInfo"===t.name&&e.initShop()})},beforeRouteLeave:function(e,t,s){"/NewCustomerInfo"===e.name&&this.initShop(),s()},computed:o()({},Object(i.d)({btn:function(e){return e.chooseShop.btn},shopVal:function(e){return e.chooseShop.shopVal}})),created:function(){this.btn&&this.btn.length?this.btnlist=this.btn:(this.btnlist=a.a.btnList(["意向客户","游客"],0),this.setBtn(this.btnlist))},mounted:function(){},methods:o()({},Object(i.c)(["setBtn","initShopList","getShopVal"]),{customerSelect:function(e){this.btnlist.forEach(function(t,s){t.status=e===s}),this.setBtn(this.btnlist)},initShop:function(){var e=JSON.parse(localStorage.getItem("shops")),t=Object(r.a)(e,0);this.initShopList(t),this.getShopVal()}})},L={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"newCustomer"},[s("my-banner",{attrs:{title:"新建"}}),e._v(" "),s("ul",{staticClass:"customerSelect"},e._l(e.btnlist,function(t,n){return s("li",{key:"btns11"+n,class:{on:t.status},on:{click:function(t){return e.customerSelect(n)}}},[e._v("\n    "+e._s(t.name)+"\n    "),s("hr",{directives:[{name:"show",rawName:"v-show",value:t.status,expression:"item.status"}]})])}),0),e._v(" "),s("customer-search",{directives:[{name:"show",rawName:"v-show",value:e.btnlist[0].status,expression:"btnlist[0].status"}]}),e._v(" "),s("visitor",{directives:[{name:"show",rawName:"v-show",value:e.btnlist[1].status,expression:"btnlist[1].status"}],attrs:{fromName:e.fromName}})],1)},staticRenderFns:[]};var D=s("C7Lr")(P,L,!1,function(e){s("zUBm")},"data-v-02c74e1b",null);t.default=D.exports},U03w:function(e,t){},lHPd:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAABdUlEQVRIS92UL0hDURTGvzte0CQYbROTQbDJHPdgsBlWXNFgEYOIRZPdIAjmNcEoGOzizn3MqkEQ/INFWDHZZLufTLbHdNvb29wrvvR455zvxznnfccg5cekrI9/AFDVHQDrAMZJ1o0x7V213qNv7XGScbkByQejqkxzD8Y5d0JyNyVI7btFVb0EsJICpBDNUFXvAcyOCkJyT0SOI0ClUpms1WovACb+CiFZEpGths4PH6jqHIC7PwKurbVLLY0Oo6lqAcDFkJDXarU6UywW6z0BzaXvAzgaEPIZBMF0Lpd7a6/reSpUtQRgMymE5KKIVH7nx94i59wVyWievWAkN0TktFs8FkAy45x7ApCN6eTQWnvQK973moZhOOW9fwYw1kXk3Fq7GjfGvoBGcRiGC977m3YhkrciMt9vR4kADZFyubxmjDlrCr5nMplsPp//GBmg9fsaY5a999si8thPvMPJSQoGzUk8okGFY508rNjAPhgF6AvOC38pYviadwAAAABJRU5ErkJggg=="},o8Vv:function(e,t){},ohT3:function(e,t){},z4EY:function(e,t){},zUBm:function(e,t){}});
//# sourceMappingURL=28.7044aea811cbf4de50f4.js.map